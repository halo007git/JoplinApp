id: 925a01179bb343debf820c48bdc07210
parent_id: 
item_type: 1
item_id: b395cba126394052be3c22817a9df58e
item_updated_time: 1688386767619
title_diff: "[{\"diffs\":[[1,\"(124条消息) HIDL概述_Gunder的博客-CSDN博客\"]],\"start1\":0,\"start2\":0,\"length1\":0,\"length2\":32}]"
body_diff: "[{\"diffs\":[[1,\"## <a id=\\\"t0\\\"></a>HIDL背景\\\n\\\nTreble 是 Google Android 团队的一项重大项目，意在 Android 操作系统框架在架构方面的一项重大改变，旨在让制造商以更低的成本更轻松、更快速地将设备更新到新版 Android 系统。Android 7.x 及更早版本中没有正式的供应商接口，因此设备制造商必须更新大量 Android 代码才能将设备更新到新版 Android 系统：\\\n\\\n![](https://img-blog.csdnimg.cn/20181127102423948.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3UwMTMzNTc1NTc=,size_16,color_FFFFFF,t_70)\\\n图1 Treble 推出前的Android 更新环境\\\n\\\nAndroid O以后，Treble 提供了一个稳定的新供应商接口，供设备制造商访问 Android 代码中特定于硬件的部分，这样一来，设备制造商只需更新 Android 操作系统框架，即可跳过芯片制造商直接提供新的 Android 版本：\\\n\\\n![](https://img-blog.csdnimg.cn/2018112710242399.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3UwMTMzNTc1NTc=,size_16,color_FFFFFF,t_70)\\\n\\\n图2 Treble 推出后的Android 更新环境\\\n\\\n## <a id=\\\"t1\\\"></a>HIDL简介\\\n\\\nHIDL 是用于指定 HAL 与其用户之间接口的一个**接口描述语言（Interface Description Language）**，它允许将指定的类型与函数调用收集到**接口（Interface）**和**包（Package）**中。更广泛地说，HIDL 是一个可以让那些独立编译的**代码库（Libraries）**之间进行通信的系统。 HIDL 实际上是用于进行**进程间通信（Inter-process Communication，IPC）**的。进程间的通信可以称为 **Binder** **化（Binderized）**。对于必须连接到进程的库，也可以使用 **passthough** **模式**（但在Java中不支持）。 HIDL 将指定的数据结构与方法签名组织到接口中，这些接口又会被收集到包中以供使用。它的语法与 C++、JAVA 是类似的，不过关键字集合不尽相同。其注释风格与 JAVA 是一致的。\\\n\\\n## <a id=\\\"t2\\\"></a>HIDL设计\\\n\\\n设计 HIDL 这个机制的目的，主要是想把**框架（framework）**与 HAL 进行隔离，使得框架部分可以直接被覆盖、更新，而不需要重新对 HAL 进行编译。HAL 的部分将会放在设备的 `/vendor` 分区中，并且是由设备供应商（vendors）或 SOC 制造商来构建。这使得框架部分可以通过 `OTA` 方式更新，同时不需要重新编译 HAL。\\\n\\\n## <a id=\\\"t3\\\"></a>3.1直通式HAL（ Passthrough 模式）和 绑定式 HAL （Binderized模式）\\\n\\\n    为了将以往设备的 `Android` 版本更新到 `Android O`，开发者需要将传统的 `HAL` 封装到新的 HIDL 接口中，这个接口为 `HAL` 提供了 Binder 化以及 Passthrough 模式。这个封装过程对 `HAL` 以及 `Android Framework` 都是透明的。\\\n   Passthrough 模式仅对 `C++` 客户端与实现适用，以往的 `Android` 版本设备中，`HAL` 不会采用 `JAVA` 语言来写，所以 `JAVA HAL` 必然是 Binder 化的。\\\n\\\n绑定式 HAL。以 HAL 接口定义语言 (HIDL) 表示的 HAL。这些 HAL 取代了早期 Android 版本中使用的传统 HAL 和旧版 HAL。在绑定式 HAL 中，Android 框架和 HAL 之间通过 Binder 进程间通信 (IPC) 调用进行通信。所有在推出时即搭载了 Android 8.0 或后续版本的设备都必须只支持绑定式 HAL。大致框架图如下，对于Android O之前的设备，对应图1，对于从之前的设备升级到O的版本，对应图2、图3. 对于直接基于Android O开发的设备，对应图4。\\\n\\\n![](https://img-blog.csdnimg.cn/20181127102426430.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3UwMTMzNTc1NTc=,size_16,color_FFFFFF,t_70)\\\n\\\n在Android O之前，HAL是一个个的.so库，通过dlopen来进行打开，库和framework位于同一个进程。如图3所示：\\\n\\\n![](https://img-blog.csdnimg.cn/20181127102422903.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3UwMTMzNTc1NTc=,size_16,color_FFFFFF,t_70)\\\n\\\n图3 Android O之前Framework跟HAL的通信\\\n\\\n在Android O之后，framework和hal运行于不同的进程，所有的HAL采用新的HIDL技术来完成。\\\n\\\n![](https://img-blog.csdnimg.cn/20181127102423507.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3UwMTMzNTc1NTc=,size_16,color_FFFFFF,t_70)\\\n\\\n图4 Android O之后Framework跟HAL的通信\\\n\\\n## <a id=\\\"t4\\\"></a>参考文献\\\n\\\n1、 Android HIDL 简介\\\n\\\nhttps://blog.csdn.net/qidi_huang/article/details/76572404\\\n\\\n2、 Android HIDL学习（1） ---- 简介\\\n\\\nhttps://www.jianshu.com/p/b3a2c7117ccc\\\n\\\n3、Android HIDL学习（2） ---- HelloWorld\\\n\\\nhttps://www.jianshu.com/p/ca6823b897b5\\\n\\\n4、探索hidl-gen使用及IWifi.hal 实现\\\n\\\nhttps://blog.csdn.net/sinat_20059415/article/details/81808212\\\n\\\n5、在Android 8.0之后版本上添加Hidl Service\\\n\\\nhttps://blog.csdn.net/anlory/article/details/82025916\\\n\\\n6、AndroidO Treble架构下hwservicemanager启动过程\\\n\\\nhttps://blog.csdn.net/marshal_zsx/article/details/80293163\\\n\\\n7、Android8.1HAL层开发\\\n\\\nhttps://blog.csdn.net/u013082948/article/details/80529419    //重点\\\n\\\n8、android中SELINUX规则分析和语法简介\\\n\\\nhttps://www.2cto.com/kf/201504/390742.html\\\n\\\n9、如何关闭JACK编译器\\\n\\\nhttps://blog.csdn.net/qilu0882/article/details/81328953\\\n\\\n10、Android Treble架构解析\\\n\\\nhttps://www.cnblogs.com/wangzhe1635/p/9034640.html\\\n\\\n11、关闭Android jack 编译\\\n\\\nhttps://blog.csdn.net/kkguo1990/article/details/74738901\"]],\"start1\":0,\"start2\":0,\"length1\":0,\"length2\":3724}]"
metadata_diff: {"new":{"id":"b395cba126394052be3c22817a9df58e","parent_id":"ed7743e3aa5a4f04ac684bf8de2eb35b","latitude":"0.00000000","longitude":"0.00000000","altitude":"0.0000","author":"","source_url":"https://blog.csdn.net/u013357557/article/details/84561457","is_todo":0,"todo_due":0,"todo_completed":0,"source":"joplin-desktop","source_application":"net.cozic.joplin-desktop","application_data":"","order":1688386767619,"markup_language":1,"is_shared":0,"share_id":"","conflict_original_id":"","master_key_id":"","user_data":""},"deleted":[]}
encryption_cipher_text: 
encryption_applied: 0
updated_time: 2023-07-03T12:20:42.829Z
created_time: 2023-07-03T12:20:42.829Z
type_: 13